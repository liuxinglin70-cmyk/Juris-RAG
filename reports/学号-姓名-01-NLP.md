# Juris-RAG 课程项目报告（学号-姓名-01-NLP）

> 请将文件名与本文档中的“学号/姓名”替换为真实信息后提交。

## 1. 项目概述
- 领域：中文法律（刑法为核心，覆盖民/商/行政/劳动）
- 目标：构建可解释的领域特定问答系统，支持长上下文、多轮对话、引用展示与拒绝不确定回答。
- 现状：数据处理、向量库构建、RAG 引擎、Gradio Web UI、评估脚本均可运行。

## 2. 数据来源与处理
- 法条：五大领域官方文本（2020 修订版），存放于 `data/raw/*.txt`。
- 案例：CAIL2018 `cail_cases.json`（默认 100k，可通过 `CAIL_CASE_LIMIT` 抽样）。
- 处理流程（`src/data_processing.py`）：
  1) 清洗分条，去控制字符；
  2) 分块 `chunk_size=800/overlap=150`，保持语义完整；
  3) BGE-M3 向量化（SiliconFlow API），写入 `data/vector_db/<domain>`；
  4) 节流：RPM/TPM 限制、批处理、重试+退避，避免 429。

## 3. 方法与系统设计
- 检索：罪名关键词多查询增强 + 法条/案例双通道检索，法条优先权重 1.5x。
- 生成：Qwen3-8B（128K 上下文），低温度生成，展示引用与置信度。
- 多轮：保留 15 轮历史，支持追问与上下文衔接。
- 拒答：越界关键词 + 相关性阈值双判定；低置信度提示。
- 前端：Gradio ChatGPT 风格，模式切换（智能问答 / 文档搜索 / 系统信息），引用侧栏与置信度徽章。

## 4. 实验与结果（23 样本评估集 `data/eval/eval_set.json`）
- 命令：`python eval.py`
- 指标：

| 指标 | 数值 | 说明 |
|------|------|------|
| 准确率 | 65.22% | 15/23 样本正确 |
| 引用 F1 | 86.75% | 引用质量综合指标 |
| 幻觉率 | 21.74% | 少见罪名/边界场景为主 |
| 平均响应 | 9.15s | 2048 tokens 生成 |

## 5. 问题分析
- 少见罪名（走私、强奸等）覆盖不足，易产生幻觉或答非所问。
- 超范围拒答仍有漏判，需要更强的判别/重排。
- 长尾延迟存在（向量化与生成），需缓存/并行优化。

## 6. 创新点
- 五领域独立向量库 + 法条优先权重，便于按域扩展与调优。
- 罪名关键词映射驱动的多查询增强，提升法条命中率。
- 关键词 + 相关性双重超范围判别，配合置信度与拒答模板。
- API 节流与退避策略，适配 SiliconFlow 配额，提升稳定性。
- Gradio 6 兼容的 UI，支持引用侧栏、模式切换与消息格式自动适配。

## 7. Demo 访问方式
- 本地启动：`python app.py`，浏览器访问 `http://127.0.0.1:7860`
- 局域网：设置 `GRADIO_SERVER_NAME=0.0.0.0` 后启动，用本机 IP 访问。
- 公网（可选）：`GRADIO_SHARE=true`（需本地 `frpc_windows_amd64_v0.3`），自动生成 `*.gradio.live` 链接。

## 8. 未来改进
- 引入 reranker/判别器强化超范围拒答与排序。
- 扩充少见罪名与新领域（知产、税法），支持增量索引与版本管理。
- 缓存/并行优化长尾延迟，加入评估 CI 与可视化看板。
- 支持用户上传文档即时索引，增强检索/引用可视化。

## 9. 提交说明
- 代码：完整放置于仓库，含数据处理、训练/推理、评估、部署脚本。
- 报告：本文件（`学号-姓名-01-NLP.md` 或 `.pdf`），按命名规范提交。
- PR：遵循课程模板，附代码仓库与 Demo 链接。
